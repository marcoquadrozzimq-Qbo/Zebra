<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Convertitore Immagini in ZPL</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  input, button { margin: 5px 0; display: block; }
  pre { background: #f0f0f0; padding: 10px; white-space: pre-wrap; word-wrap: break-word; }
</style>
</head>
<body>
<h1>Convertitore Immagini in ZPL</h1>

<label>Seleziona immagine (bianco/nero consigliato):
  <input type="file" id="imgFile" accept="image/*">
</label>

<label>Larghezza (px):
  <input type="number" id="imgWidth" value="1200">
</label>

<label>Altezza (px):
  <input type="number" id="imgHeight" value="800">
</label>

<button id="convertBtn">Converti in ZPL</button>

<h2>Codice ZPL generato:</h2>
<pre id="zplOutput"></pre>

<script>
function convertCanvasToZPL(canvas) {
  const width = canvas.width;
  const height = canvas.height;
  const ctx = canvas.getContext('2d');
  const imageData = ctx.getImageData(0, 0, width, height).data;
  
  let zpl = `^XA\n`;
  for(let y = 0; y < height; y++){
    let row = '';
    for(let x = 0; x < width; x++){
      const i = (y*width + x)*4;
      const bw = imageData[i] < 128 ? '1' : '0'; // 1-bit bianco/nero
      row += bw;
    }
    zpl += `^FO0,${y}^GB${width},1,1,B,${row}^FS\n`; // semplice esempio di riga
  }
  zpl += `^XZ`;
  return zpl;
}

document.getElementById('convertBtn').addEventListener('click', () => {
  const fileInput = document.getElementById('imgFile');
  const width = parseInt(document.getElementById('imgWidth').value);
  const height = parseInt(document.getElementById('imgHeight').value);

  if (!fileInput.files.length) return alert('Seleziona un file');

  const reader = new FileReader();
  reader.onload = function(e) {
    const img = new Image();
    img.onload = function() {
      const canvas = document.createElement('canvas');
      canvas.width = width;
      canvas.height = height;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(img, 0, 0, width, height);

      // Conversione in bianco e nero
      const imageData = ctx.getImageData(0, 0, width, height);
      const data = imageData.data;
      for (let i = 0; i < data.length; i += 4) {
        const gray = (data[i] + data[i+1] + data[i+2]) / 3;
        const bw = gray > 128 ? 255 : 0;
        data[i] = data[i+1] = data[i+2] = bw;
      }
      ctx.putImageData(imageData, 0, 0);

      // Genera ZPL
      const zpl = convertCanvasToZPL(canvas);
      document.getElementById('zplOutput').textContent = zpl;
    };
    img.src = e.target.result;
  };
  reader.readAsDataURL(fileInput.files[0]);
});
</script>

</body>
</html>
